{- 
   –¢–µ–æ—Ä–µ—Ç–∏–∫–æ-—Ç–∏–ø–æ–≤–∞—è —ç–∫—Å–ø–ª–∏–∫–∞—Ü–∏—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–ø–ø–∞—Ä–∞—Ç–∞ —Ä–æ–¥–æ–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä.
   –°–º. 1) –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ 2 –∫–Ω–∏–≥–∏: –ö–æ–Ω–æ–Ω–µ–Ω–∫–æ –ê. –ê., –ö—É—á–∫–∞—Ä–æ–≤ 3. –ê., –ù–∏–∫–∞–Ω–æ—Ä–æ–≤ –°. –ü., –ù–∏–∫–∏—Ç–∏–Ω–∞ –ù. –ö.
   –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/ –ü–æ–¥ —Ä–µ–¥. –°. –ü. –ù–∏–∫–∞–Ω–æ—Ä–æ–≤–∞.
   2-–µ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø, –∏–∑–¥., ‚Äî –ú.: –ö–æ–Ω—Ü–µ–ø—Ç. ‚Äî 2008. ‚Äî 580 —Å.
   2) –ü–æ–Ω–æ–º–∞—Ä—ë–≤ –ò. –ù. –í–≤–µ–¥–µ–Ω–∏–µ –≤ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ª–æ–≥–∏–∫—É –∏ —Ä–æ–¥—ã —Å—Ç—Ä—É–∫—Ç—É—Ä: –£—á–µ–±–Ω–æ–µ
   –ø–æ—Å–æ–±–∏–µ. ‚Äî –ú. : –ú–§–¢–ò, 2007
-}
{-# OPTIONS --cubical --warning=noUnsupportedIndexedMatch #-}
{-# OPTIONS --guardedness #-}

module Base where

open import Cubical.Foundations.Prelude
open import Cubical.Foundations.Function using (_‚àò_; uncurry)
open import Cubical.Foundations.HLevels
open import Cubical.Foundations.Powerset using (‚Ñô; isSet‚Ñô; _‚àà_)
open import Cubical.Foundations.Structure using (‚ü®_‚ü©)
open import Cubical.Data.Bool using (Bool; true; false; isSetBool)
open import Cubical.Data.Empty using (‚ä•*; isProp‚ä•*)
open import Cubical.Data.FinData using (Fin; zero; suc; one; two; three; four; five; to‚Ñï)
open import Cubical.Data.Nat using (‚Ñï; zero; suc; _+_; _‚à∏_; isSet‚Ñï; max)
open import Cubical.Data.Nat.Order using (_‚â§_; isProp‚â§)
open import Cubical.Data.Sigma using (_√ó_; _,_; ‚àÉ; ‚àÉ-syntax)
open import Cubical.Data.Sum using (_‚äé_)
open import Cubical.Data.Vec using (Vec; _‚à∑_; []; lookup; head; tail; foldr; map) 
open import Cubical.Data.Unit using (Unit; tt; isPropUnit)
open import Cubical.HITs.PropositionalTruncation hiding (map) --using (‚à•_‚à•‚ÇÅ; ‚à£_‚à£‚ÇÅ; squash‚ÇÅ; isPropPropTrunc)

open import Powerset public


------------------------------------------------------------------
--== –°—Ç—É–ø–µ–Ω–∏ ==--

-- DSL —Ä–æ–¥–æ–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä. n = —á–∏—Å–ª–æ –±–∞–∑–æ–≤—ã—Ö —Ç–∏–ø–æ–≤, m = —á–∏—Å–ª–æ —Å–æ–º–Ω–æ–∂–∏—Ç–µ–ª–µ–π
-- –¥–µ–∫–∞—Ä—Ç–æ–≤–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è (‚â• 2)
data –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (n : ‚Ñï) : Type where
  base : Fin n ‚Üí –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ n                                 -- –±–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã
  ùîÖ    : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ n ‚Üí –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ n                        -- –±—É–ª–µ–∞–Ω  
  ùîá    : ‚àÄ {m} ‚Üí Vec (–°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ n) (2 + m) ‚Üí –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ n  -- –¥–µ–∫–∞—Ä—Ç–∏–∞–Ω, m ‚â• 2

-- —Ä–∞–Ω–≥ —Å—Ç—É–ø–µ–Ω–∏
œÅ : ‚àÄ {n} ‚Üí –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ n ‚Üí ‚Ñï
œÅ (base x) = 1
œÅ (ùîÖ S) = œÅ S + 1
œÅ {n} (ùîá LS) = maxL LS + 1
  where
  maxL : ‚àÄ {m} ‚Üí Vec (–°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ n) (2 + m) ‚Üí ‚Ñï
  maxL (S1 ‚à∑ S2 ‚à∑ []) = max (œÅ S1) (œÅ S2) 
  maxL (S1 ‚à∑ S2 ‚à∑ S3 ‚à∑ tail) = max (œÅ S1) (maxL (S2 ‚à∑ S3 ‚à∑ tail))


------------------------------------------------------------------
--== M-–≥—Ä–∞—Ñ ==--

-- n - —á–∏—Å–ª–æ –±–∞–∑–æ–≤—ã—Ö —Ç–∏–ø–æ–≤,
-- k - –Ω–æ–º–µ—Ä —É–∑–ª–∞ –≤ M-–≥—Ä–∞—Ñ–µ (= —á–∏—Å–ª–æ —É–∑–ª–æ–≤ –≤ M-–≥—Ä–∞—Ñ–µ, –∫ –∫—Ç—Ä. –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è —Å—Ç—É–ø–µ–Ω—å)
data M-—É–∑–µ–ª (n : ‚Ñï) : ‚Ñï ‚Üí Type where
  base : ‚àÄ {k} ‚Üí Fin n ‚Üí M-—É–∑–µ–ª n k
  ùîÖ    : ‚àÄ {k} ‚Üí Fin (1 + k) ‚Üí M-—É–∑–µ–ª n (1 + k)
  ùîá    : ‚àÄ {k m} ‚Üí Vec (Fin (2 + k)) (2 + m) ‚Üí M-—É–∑–µ–ª n (2 + k)

infixr 6 _&_

-- k - —á–∏—Å–ª–æ —É–∑–ª–æ–≤/—Å—Ç—É–ø–µ–Ω–µ–π
data M-–≥—Ä–∞—Ñ (n : ‚Ñï) : (k : ‚Ñï) ‚Üí Type where
  ‚àÖ   : M-–≥—Ä–∞—Ñ n 0
  _&_ : ‚àÄ {k} ‚Üí M-—É–∑–µ–ª n k ‚Üí M-–≥—Ä–∞—Ñ n k ‚Üí M-–≥—Ä–∞—Ñ n (1 + k)

-- –°—Ö–µ–º–∞ i-–≥–æ —É–∑–ª–∞ –≥—Ä–∞—Ñ–∞.
-- –°—Ö–µ–º—ã –µ—Å—Ç—å —É —É–∑–ª–æ–≤, –Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É –≥—Ä–∞—Ñ–∞ –≤ —Ü–µ–ª–æ–º
M-–°—Ö–µ–º–∞ : ‚àÄ {n k} ‚Üí M-–≥—Ä–∞—Ñ (1 + n) (1 + k) ‚Üí Fin (1 + k) ‚Üí –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)
M-–°—Ö–µ–º–∞ (base i & _) zero = base i
M-–°—Ö–µ–º–∞ (ùîÖ i & M) zero = ùîÖ (M-–°—Ö–µ–º–∞ M i)
M-–°—Ö–µ–º–∞ (ùîá is & M) zero = ùîá (map (Œª k ‚Üí M-–°—Ö–µ–º–∞ M k) is)
M-–°—Ö–µ–º–∞ {k = suc k} (_ & M) (suc i) = M-–°—Ö–µ–º–∞ M i


------------------------------------------------------------------
--== –ë–∞–∑–∏—Å–Ω—ã–µ —Ç–∏–ø—ã ==--

-- –°–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤, –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–∫–æ–º —É—Ä–æ–≤–Ω–µ–π.
-- –¢.–æ. —Å–ø–∏—Å–∫–∏ —Ç–∏–ø–æ–≤ –∏ —É—Ä–æ–≤–Ω–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–≥–ª–∞—Å—É—é—Ç—Å—è.
-- –î–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–∏–ø—ã, —è–≤–ª—è—é—â–∏–µ—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞–º–∏ (hSet).
data BaseSets : ‚àÄ {n} ‚Üí Vec Level n ‚Üí Typeœâ where
  []  : BaseSets []
  _‚à∑_ : ‚àÄ {n ‚Ñì1} {L‚Ñì : Vec Level n} ‚Üí hSet ‚Ñì1 ‚Üí BaseSets L‚Ñì ‚Üí BaseSets (‚Ñì1 ‚à∑ L‚Ñì)

-- –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑ BaseSets –ø–æ –∏–Ω–¥–µ–∫—Å—É. BaseSets –Ω–µ–ø—É—Å—Ç.
_[_] : ‚àÄ {n} {L‚Ñì : Vec Level (1 + n)} ‚Üí BaseSets L‚Ñì ‚Üí (i : Fin (1 + n)) ‚Üí hSet (lookup i L‚Ñì)
_[_] (A ‚à∑ _) zero = A
_[_] {suc n} (_ ‚à∑ tail) (suc i) = tail [ i ] 


------------------------------------------------------------------
--== –û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ–æ—Ä–∏—è: —Ä–æ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ==--

module –†–æ–¥–°—Ç—Ä—É–∫—Ç—É—Ä—ã 
    {n : ‚Ñï}                     -- n = —á–∏—Å–ª–æ –±–∞–∑–æ–≤—ã—Ö —Ç–∏–ø–æ–≤
    {L‚Ñì : Vec Level (1 + n)}    -- —É—Ä–æ–≤–Ω–∏ –±–∞–∑–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ (n ‚â• 1)
    (BS : BaseSets {1 + n} L‚Ñì)  -- —Å–ø–∏—Å–æ–∫ –±–∞–∑–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ (n ‚â• 1)
    where

  -- —Å—É–º–º–∞—Ä–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å (—É–Ω–∏–≤–µ—Ä—Å—É–º–∞) —Å—Ö–µ–º—ã; –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–ø–∏—Å–∫–∞ —É—Ä–æ–≤–Ω–µ–π L‚Ñì
  ‚Ñìtot : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n) ‚Üí Level
  ‚Ñìtot (base i) = lookup i L‚Ñì
  ‚Ñìtot (ùîÖ S) = ‚Ñì-suc (‚Ñìtot S)
  ‚Ñìtot (ùîá (S1 ‚à∑ S2 ‚à∑ [])) = ‚Ñì-max (‚Ñìtot S1) (‚Ñìtot S2)
  ‚Ñìtot (ùîá (S1 ‚à∑ S2 ‚à∑ S3 ‚à∑ tail)) = ‚Ñì-max (‚Ñìtot S1) (‚Ñìtot (ùîá (S2 ‚à∑ S3 ‚à∑ tail)))
  
  -- –°—Ç—É–ø–µ–Ω—å: –ø–µ—Ä–µ–≤–æ–¥ —Å—Ö–µ–º—ã –≤ —Ç–∏–ø —Ç–µ–æ—Ä–∏–∏ —Ç–∏–ø–æ–≤
  –°—Ç—É–ø–µ–Ω—å : (S : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)) ‚Üí Type (‚Ñìtot S) 
  –°—Ç—É–ø–µ–Ω—å (base i) = fst (BS [ i ])
  –°—Ç—É–ø–µ–Ω—å (ùîÖ S) = ‚Ñô (–°—Ç—É–ø–µ–Ω—å S)
  –°—Ç—É–ø–µ–Ω—å (ùîá (S1 ‚à∑ S2 ‚à∑ [])) = –°—Ç—É–ø–µ–Ω—å S1 √ó –°—Ç—É–ø–µ–Ω—å S2
  –°—Ç—É–ø–µ–Ω—å (ùîá (S1 ‚à∑ S2 ‚à∑ S3 ‚à∑ tail)) = –°—Ç—É–ø–µ–Ω—å S1 √ó –°—Ç—É–ø–µ–Ω—å (ùîá (S2 ‚à∑ S3 ‚à∑ tail))
  
  -- –≤—Å–µ —Å—Ç—É–ø–µ–Ω–∏ -- –º–Ω–æ–∂–µ—Å—Ç–≤–∞
  –°—Ç—É–ø–µ–Ω—åIsSet : (S : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)) ‚Üí isSet (–°—Ç—É–ø–µ–Ω—å S)
  –°—Ç—É–ø–µ–Ω—åIsSet (base i) = snd (BS [ i ])
  –°—Ç—É–ø–µ–Ω—åIsSet (ùîÖ S) = isSet‚Ñô
  –°—Ç—É–ø–µ–Ω—åIsSet (ùîá (S1 ‚à∑ S2 ‚à∑ [])) = isSet√ó (–°—Ç—É–ø–µ–Ω—åIsSet S1) (–°—Ç—É–ø–µ–Ω—åIsSet S2)
  –°—Ç—É–ø–µ–Ω—åIsSet (ùîá (S1 ‚à∑ S2 ‚à∑ S3 ‚à∑ tail)) =
    isSet√ó (–°—Ç—É–ø–µ–Ω—åIsSet S1) (–°—Ç—É–ø–µ–Ω—åIsSet (ùîá (S2 ‚à∑ S3 ‚à∑ tail)))
  
  -- –°—Ç—É–ø–µ–Ω—å i-–≥–æ —É–∑–ª–∞ M-–≥—Ä–∞—Ñ–∞
  M-–°—Ç—É–ø–µ–Ω—å : ‚àÄ {k} ‚Üí (M : M-–≥—Ä–∞—Ñ (1 + n) (1 + k)) ‚Üí (i : Fin (1 + k)) ‚Üí Type _ 
  M-–°—Ç—É–ø–µ–Ω—å M i = –°—Ç—É–ø–µ–Ω—å (M-–°—Ö–µ–º–∞ M i)
  
  
  -------------------------------------------------------
  --== –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ —Ç–µ—Ä–º–∞–º–∏ (—Å—Ç—É–ø–µ–Ω–µ–π) ==--
  
  -- –ø–æ–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∏–Ω–≥–ª–µ—Ç–æ–Ω–æ–≤)
  -- TODO: –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ isContr (–¥–ª—è ‚Ñô)

  -- —Å–∏–Ω–≥–ª–µ—Ç–æ–Ω
  isSingl : ‚àÄ {‚Ñì} {X : Type ‚Ñì} ‚Üí ‚Ñô X ‚Üí Type ‚Ñì
  isSingl {‚Ñì} {X} t = Œ£[ x ‚àà X ] (t x .fst) √ó (‚àÄ y ‚Üí t y .fst ‚Üí Path _ x y)
  
  –°—Ç—É–ø–µ–Ω—å‚Üì : ‚àÄ {S : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)} ‚Üí (t : –°—Ç—É–ø–µ–Ω—å (ùîÖ S)) ‚Üí isSingl t ‚Üí –°—Ç—É–ø–µ–Ω—å S
  –°—Ç—É–ø–µ–Ω—å‚Üì _ p = fst p
  
  -- –º–∞–ª–∞—è –ø—Ä–æ–µ–∫—Ü–∏—è
  
  pr : ‚àÄ {m} {LS : Vec (–°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)) (2 + m)}
     ‚Üí –°—Ç—É–ø–µ–Ω—å (ùîá LS)
     ‚Üí (i : Fin (2 + m))
     ‚Üí –°—Ç—É–ø–µ–Ω—å (lookup i LS)
  pr {LS = _ ‚à∑ _ ‚à∑ []}    (x , _)     zero = x
  pr {LS = _ ‚à∑ _ ‚à∑ []}    (_ , x)      one = x
  pr {LS = _ ‚à∑ _ ‚à∑ _ ‚à∑ _} (x , _)     zero = x
  pr {LS = _ ‚à∑ _ ‚à∑ _ ‚à∑ _} (_ , xs) (suc i) = pr xs i
  
  -- –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏
  
  –°—Ç—É–ø–µ–Ω—å‚Üë : ‚àÄ {S : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)} ‚Üí –°—Ç—É–ø–µ–Ω—å S ‚Üí –°—Ç—É–ø–µ–Ω—å (ùîÖ S)
  –°—Ç—É–ø–µ–Ω—å‚Üë {S} t = Œª x ‚Üí (t ‚â° x) , –°—Ç—É–ø–µ–Ω—åIsSet S t x
  
  -- –°—Ç—É–ø–µ–Ω—å‚Üë S - —Å–∏–Ω–≥–ª–µ—Ç–æ–Ω –¥–ª—è –ª—é–±–æ–π —Å—Ç—É–ø–µ–Ω–∏
  –°—Ç—É–ø–µ–Ω—å‚ÜëIsSingl : {S : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)}
    ‚Üí (t : –°—Ç—É–ø–µ–Ω—å S)
    ‚Üí isContr (‚ÑôŒ£ (–°—Ç—É–ø–µ–Ω—å S) (–°—Ç—É–ø–µ–Ω—å‚Üë {S = S} t))  
  –°—Ç—É–ø–µ–Ω—å‚ÜëIsSingl t = isContrSingl t
  
  -- –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤

  -- —Å–ø–∏—Å–æ–∫ —Ç–µ—Ä–º–æ–≤ –¥–ª—è –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è. –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω —Å—Ö–µ–º–∞–º–∏ —Ç–µ—Ä–º–æ–≤.
  data TermList : ‚àÄ {m} (LS : Vec (–°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)) m) ‚Üí Typeœâ where
    [] : TermList []
    _‚à∑_ : ‚àÄ {m} {LS : Vec (–°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)) m} {S : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)}
        ‚Üí –°—Ç—É–ø–µ–Ω—å S ‚Üí TermList LS ‚Üí TermList (S ‚à∑ LS)
  
  prodN : ‚àÄ {m} {LS : Vec (–°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)) (2 + m)}
        ‚Üí (Lt : TermList LS) ‚Üí –°—Ç—É–ø–µ–Ω—å (ùîá LS) 
  prodN (t1 ‚à∑ t2 ‚à∑ []) = t1 , t2
  prodN (t1 ‚à∑ t2 ‚à∑ t3 ‚à∑ tail) = t1 , prodN (t2 ‚à∑ t3 ‚à∑ tail)
  
  
  -- –±–æ–ª—å—à–∞—è –ø—Ä–æ–µ–∫—Ü–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏—è
  -- TODO: –Ω—É–∂–Ω–∞ –ª–∏ ‚àÉ ?
  -- TODO: —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å Lift (–∏–ª–∏ –Ω–µ—Ç?)
  
  Pr : ‚àÄ {m} {LS : Vec (–°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)) (2 + m)}
     ‚Üí ‚Ñô (–°—Ç—É–ø–µ–Ω—å (ùîá LS))
     ‚Üí (i : Fin (2 + m))
     ‚Üí ‚Ñô (Lift {j = ‚Ñì-max (‚Ñìtot (lookup i LS)) (‚Ñìtot (ùîá LS))} (–°—Ç—É–ø–µ–Ω—å (lookup i LS)))
  Pr {m} {LS} S i = Œª x ‚Üí isPr (lower x) , squash‚ÇÅ
    where
    isPr : –°—Ç—É–ø–µ–Ω—å (lookup i LS) ‚Üí Type _
    isPr s = ‚àÉ[ y ‚àà (–°—Ç—É–ø–µ–Ω—å (ùîá LS)) ] (y ‚àà S) √ó (s ‚â° (pr y i))
  
 
  -- –∑–∞–¥–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ–º
  
  enum : ‚àÄ {S : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)} {m} {LS : Vec (–°—Ç—É–ø–µ–Ω—å S) m}
       ‚Üí (–°—Ç—É–ø–µ–Ω—å (ùîÖ S))
  enum {S} {m} {LS} = Œª x ‚Üí any (Œª y ‚Üí (x ‚â° y) , –°—Ç—É–ø–µ–Ω—åIsSet S x y) LS 
    where
    _‚à® ∞_ : ‚àÄ {‚Ñì} ‚Üí hProp ‚Ñì ‚Üí hProp ‚Ñì ‚Üí hProp ‚Ñì
    (P , pP) ‚à® ∞ (Q , pQ) = ‚à• P ‚äé Q ‚à•‚ÇÅ , squash‚ÇÅ
  
    ‚ä• ∞ : ‚àÄ {‚Ñì} ‚Üí hProp ‚Ñì
    ‚ä• ∞ = ‚ä•* , Œª ()
    
    any : ‚àÄ {‚Ñì} {A : Type ‚Ñì} (P : A ‚Üí hProp ‚Ñì) ‚Üí Vec A m ‚Üí hProp ‚Ñì
    any P V = foldr (Œª x y ‚Üí (P x) ‚à® ∞ y) (‚ä• ∞) V
  
  -- –ø—Ä–æ—Å—Ç–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ
  
  _‚à™_ : ‚àÄ {S : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)}
      ‚Üí (A B : –°—Ç—É–ø–µ–Ω—å (ùîÖ S)) ‚Üí –°—Ç—É–ø–µ–Ω—å (ùîÖ S)
  A ‚à™ B = A ‚à™·µñ B
  
  -- –ø—Ä–æ—Å—Ç–æ–µ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ
  
  _‚à©_ : ‚àÄ {S : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)}
      ‚Üí (A B : –°—Ç—É–ø–µ–Ω—å (ùîÖ S)) ‚Üí –°—Ç—É–ø–µ–Ω—å (ùîÖ S)
  A ‚à© B = A ‚à©·µñ B
  
  -- (–¥–æ–±–∞–≤–∏–º —Ç–∞–∫–∂–µ –∏–º–ø–ª–∏–∫–∞—Ü–∏—é)
  
  _‚áí_ : ‚àÄ {S : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)}
      ‚Üí (A B : –°—Ç—É–ø–µ–Ω—å (ùîÖ S)) ‚Üí –°—Ç—É–ø–µ–Ω—å (ùîÖ S)
  A ‚áí B = A ‚Üí·µñ B
  
  -- –æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ —Ç–µ—Ä–º–∞ (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∏–º–ø–ª–∏–∫–∞—Ü–∏—é)
  
  ¬¨ : ‚àÄ {S : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)}
      ‚Üí (A : –°—Ç—É–ø–µ–Ω—å (ùîÖ S)) ‚Üí –°—Ç—É–ø–µ–Ω—å (ùîÖ S)
  ¬¨ A = ¬¨·µñ A
  
  -- —Ä–∞–∑–Ω–æ—Å—Ç—å —Ç–µ—Ä–º–æ–≤
  
  _‚ï≤_ : ‚àÄ {S : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)}
      ‚Üí (A B : –°—Ç—É–ø–µ–Ω—å (ùîÖ S)) ‚Üí –°—Ç—É–ø–µ–Ω—å (ùîÖ S)
  A ‚ï≤ B = A ‚ï≤·µñ B
  
  -- —Å–∏–º–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–Ω–æ—Å—Ç—å —Ç–µ—Ä–º–æ–≤
  
  _·ç•_ : ‚àÄ {S : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)}
      ‚Üí (A B : –°—Ç—É–ø–µ–Ω—å (ùîÖ S)) ‚Üí –°—Ç—É–ø–µ–Ω—å (ùîÖ S)
  A ·ç• B = A ·ç•·µñ B
  
  -- –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ç–µ—Ä–º–æ–≤
  
  _*_ : ‚àÄ {S1 S2 : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)}
      ‚Üí (A : –°—Ç—É–ø–µ–Ω—å (ùîÖ S1)) ‚Üí (B : –°—Ç—É–ø–µ–Ω—å (ùîÖ S2)) ‚Üí –°—Ç—É–ø–µ–Ω—å (ùîÖ (ùîá (S1 ‚à∑ S2 ‚à∑ [])))
  A * B = A √ó·µñ B
  
  -- –≤–æ–∑–≤–µ–¥–µ–Ω–∏–µ –≤ —Å—Ç–µ–ø–µ–Ω—å  
    
  _^_ : ‚àÄ {SA SB : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)}
      ‚Üí (B : –°—Ç—É–ø–µ–Ω—å (ùîÖ SB)) ‚Üí (A : –°—Ç—É–ø–µ–Ω—å (ùîÖ SA)) ‚Üí –°—Ç—É–ø–µ–Ω—å (ùîÖ (ùîÖ (ùîá (SA ‚à∑ SB ‚à∑ []))))
  B ^ A = B ^·µñ A
  
  
  -------------------------------------------------------
  --== –û–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ —Ä–æ–¥–∞–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä ==--
  
  -- 5.1. –û–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ—Ä–æ–∂–¥–µ–Ω–∏—è
  
  -- —É—Å–∏–ª–µ–Ω–∏—è
  -- –æ—Å–ª–∞–±–ª–µ–Ω–∏—è
  -- (–≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
  
  -- –ø–æ—Ä–æ–∂–¥–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä
  -- (—É—Å–ª–æ–≤–∏–µ –Ω–∞ —Å—Ç—É–ø–µ–Ω—å P –∏ —ç–ª–µ–º–µ–Ω—Ç –±—É–ª–µ–∞–Ω–∞ —Å–æ–≤–ø–∞–¥–∞—é—Ç, —Ç.–∫. —è–≤–ª—è—é—Ç—Å—è –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ
  --   –ø—Ä–µ–¥–∏–∫–∞—Ç–æ–º)
  -- (—Å–º. –ø—Ä–∏–º–µ—Ä –±–∏–Ω–∞—Ä–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ)
  ‚ÜíùîÖ : ‚àÄ {Sh : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)}
             ‚Üí (–°—Ç—É–ø–µ–Ω—å Sh ‚Üí hProp _)     -- —Å–≤–æ–π—Å—Ç–≤–æ —Å—Ç—É–ø–µ–Ω–∏ 
             ‚Üí –°—Ç—É–ø–µ–Ω—å (ùîÖ Sh)
  ‚ÜíùîÖ P = P
  
  -- –ø–æ—Ä–æ–∂–¥–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã -- –æ–ø–µ—Ä–∞—Ü–∏—è, –æ–±—Ä–∞—Ç–Ω–∞—è –ø—Ä–µ–¥—ã–¥—É—â–µ–π
  
  -- (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É, –ø–æ—Å–∫–æ–ª—å–∫—É —É—Å–ª–æ–≤–∏–µ –Ω–∞ —Å—Ç—É–ø–µ–Ω—å –∏ —ç–ª–µ–º–µ–Ω—Ç –±—É–ª–µ–∞–Ω–∞ —Å–æ–≤–ø–∞–¥–∞—é—Ç)
  -- –õ—é–±–æ–π —ç–ª–µ–º–µ–Ω—Ç ‚ÑôŒ£ P –±—É–¥–µ—Ç –∏—Å–∫–æ–º–æ–π —Å—Ç—É–ø–µ–Ω—å—é.
  -- TODO: –æ–±—ä—è—Å–Ω–∏—Ç—å
  
  ‚ÜêùîÖ : ‚àÄ {Sh : –°—Ö–µ–º–∞–°—Ç—É–ø–µ–Ω–∏ (1 + n)}
             ‚Üí –°—Ç—É–ø–µ–Ω—å (ùîÖ Sh)
             ‚Üí –°—Ç—É–ø–µ–Ω—å Sh ‚Üí hProp _  -- —Å–≤–æ–π—Å—Ç–≤–æ —Å—Ç—É–ø–µ–Ω–∏ 
  ‚ÜêùîÖ P = P
  
  
  -- 5.2. –û–ø–µ—Ä–∞—Ü–∏—è —Å–∏–Ω—Ç–µ–∑–∞ (5 –≤–∏–¥–æ–≤?)
  
  -- –û—Ç–æ–∂–¥–µ—Å—Ç–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–π
  
  -- 5.3. –û–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞—Å—á–ª–µ–Ω–µ–Ω–∏—è
  
  -- –†–∞—Å—Å–µ—á–µ–Ω–∏–µ
  
  -- –†–∞—Å—Å–ª–æ–µ–Ω–∏–µ
  
  -- –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è
  
  
  --== –ü—Ä–æ—Ç–æ–∫–æ–ª –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ —Ä–æ–¥–∞–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä ==--
  
